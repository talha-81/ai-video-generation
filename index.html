<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Video Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-900 via-blue-900 to-black flex items-center justify-center p-4">

  <!-- Main Card -->
  <div class="w-full max-w-7xl bg-white/10 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 p-10 flex flex-col gap-8">
    <!-- Title -->
    <div class="text-center">
      <h1 class="text-5xl font-extrabold text-white drop-shadow-lg">ðŸš€ AI Video Generator</h1>
      <p class="text-blue-100 mt-3 text-lg">Turn a short sci-fi prompt into a narrated cinematic video</p>
    </div>

    <!-- Main Form -->
    <div class="grid md:grid-cols-2 gap-10">
      <!-- Settings -->
      <div class="bg-white/10 p-6 rounded-2xl shadow-lg border border-white/20">
        <h2 class="text-xl font-semibold text-white mb-4">Settings</h2>
        <label class="block mb-2 text-sm font-medium text-gray-200">Backend URL</label>
        <input
          type="text"
          id="backendUrl"
          value="http://localhost:8000"
          class="w-full p-3 border border-white/30 bg-white/20 text-white rounded-lg mb-4 placeholder-gray-300"
        />

        <div class="flex items-center gap-2">
          <input type="checkbox" id="useBackendPrompt" class="w-4 h-4"/>
          <span class="text-sm text-gray-200">Use backend AI prompt</span>
        </div>
      </div>

      <!-- Prompt & Assets -->
      <div class="bg-white/10 p-6 rounded-2xl shadow-lg border border-white/20">
        <h2 class="text-xl font-semibold text-white mb-4">Prompt & Assets</h2>

        <label class="block mb-2 text-sm font-medium text-gray-200">Story prompt</label>
        <textarea
          id="storyPrompt"
          class="w-full p-3 border border-white/30 bg-white/20 text-white rounded-lg mb-4 placeholder-gray-300"
          placeholder="A drifting colony ship nears a haunted nebula..."
        ></textarea>

        <label class="block mb-2 text-sm font-medium text-gray-200">Custom instruction</label>
        <div class="flex gap-2 mb-4">
          <input
            type="text"
            id="customInstruction"
            class="flex-1 p-3 border border-white/30 bg-white/20 text-white rounded-lg placeholder-gray-300"
            placeholder="Concise, wonder-filled, cosmic awe"
          />
          <button
            id="generatePromptBtn"
            class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 rounded-lg hover:scale-105 transform transition"
          >
            Generate
          </button>
        </div>

        <label class="block mb-2 text-sm font-medium text-gray-200">Optional images</label>
        <input
          type="file"
          id="images"
          multiple
          class="mb-4 text-white"
        />

        <button
          id="generateVideoBtn"
          class="bg-gradient-to-r from-pink-600 to-purple-600 text-white px-6 py-3 rounded-lg hover:scale-105 transform transition w-full"
        >
          ðŸŽ¬ Generate Video
        </button>
      </div>
    </div>

    <!-- Results -->
    <div class="mt-8 space-y-6 text-white">
      <div id="status" class="italic"></div>
      <div id="storyText" class="bg-white/10 p-4 rounded-xl shadow border border-white/20" style="display:none"></div>
      <div id="imagePrompts" class="bg-white/10 p-4 rounded-xl shadow border border-white/20" style="display:none"></div>
      <div id="imagesDisplay" class="bg-white/10 p-4 rounded-xl shadow border border-white/20" style="display:none"></div>
      <div id="audioDisplay" class="bg-white/10 p-4 rounded-xl shadow border border-white/20" style="display:none"></div>
      <div id="videoDisplay" class="bg-white/10 p-4 rounded-xl shadow border border-white/20" style="display:none"></div>
    </div>
  </div>

  <script>
    let API_BASE_URL = document.getElementById('backendUrl').value;

    document.getElementById('backendUrl').addEventListener('input', e => {
      API_BASE_URL = e.target.value;
    });

    // Utility functions to show/hide content blocks
    const hideSection = (el) => {
      el.style.display = "none";
      el.innerHTML = '';
    };
    const showSection = (el, html) => {
      el.innerHTML = html;
      el.style.display = "block";
    };

    document.getElementById('generatePromptBtn').addEventListener('click', async () => {
      const customInstruction = document.getElementById('customInstruction').value;
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = "Generating story prompt...";

      try {
        const res = await fetch(`${API_BASE_URL}/generate_prompt`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ theme: customInstruction })
        });
        const data = await res.json();
        document.getElementById('storyPrompt').value = data.prompt || '';
        statusDiv.textContent = "Story prompt generated!";
      } catch (err) {
        statusDiv.textContent = "Error generating prompt: " + err.message;
      }
    });

    document.getElementById('generateVideoBtn').addEventListener('click', async () => {
      const storyPrompt = document.getElementById('storyPrompt').value;
      const customInstruction = document.getElementById('customInstruction').value;
      const useBackendPrompt = document.getElementById('useBackendPrompt').checked;
      const files = document.getElementById('images').files;

      const statusDiv = document.getElementById('status');
      const storyTextDiv = document.getElementById('storyText');
      const imagePromptsDiv = document.getElementById('imagePrompts');
      const imagesDisplayDiv = document.getElementById('imagesDisplay');
      const audioDisplayDiv = document.getElementById('audioDisplay');
      const videoDisplayDiv = document.getElementById('videoDisplay');

      statusDiv.textContent = "Starting video generation...";
      [storyTextDiv, imagePromptsDiv, imagesDisplayDiv, audioDisplayDiv, videoDisplayDiv].forEach(hideSection);

      const formData = new FormData();
      formData.append('story_prompt', storyPrompt);
      formData.append('custom_instruction', customInstruction);
      formData.append('use_backend_prompt', useBackendPrompt);
      for (let i = 0; i < files.length; i++) {
        formData.append('images', files[i]);
      }

      try {
        const res = await fetch(`${API_BASE_URL}/generate_video`, {
          method: 'POST',
          body: formData
        });

        if (!res.ok) throw new Error('Video generation failed');

        // In a real app you'd probably get JSON with all assets, here just video:
        const blob = await res.blob();
        const videoUrl = URL.createObjectURL(blob);
        showSection(videoDisplayDiv, `<video controls class="w-full rounded-lg"><source src="${videoUrl}" type="video/mp4"></video>`);
        
        statusDiv.textContent = "Video generated successfully!";
      } catch (err) {
        statusDiv.textContent = "Error: " + err.message;
      }
    });
  </script>
</body>
</html>
